<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width" />
    <link rel="icon" href="../images/icon192.png" />
    <title>Remote and Local Files</title>
    <style>
      body {
        max-width: 500px;
      }
      #remote {
        width: 90%;
      }
    </style>
  </head>

  <body>
    <p><b id="docName"></b> &nbsp; <a href="Reading_files">Reference</a></p>
    <p>
      Remote file <br />
      <input
        type="text"
        id="remote"
        size="35"
        value="https://donmezyusuf.github.io/Advanced-Programming-Techniques/CW8/sample.txt"
      />
    </p>
    <p><input type="file" id="local" multiple onChange="fileSelect()" /></p>
    <pre id="out"></pre>
    <hr />
    <b>Sample code</b>
    <pre id="sample"></pre>

    <script>
      "use strict";
      function fileSelect() {
        fetch(remote.value)
          .then((r) => r.blob())
          .then((a) => checkFiles(a)); //called with Blob b
      }
      function checkFiles(b) {
        let a = [...local.files];
        //a.push(b);
        let url = remote.value;
        // Remote url filename
        let filename = url.substring(url.lastIndexOf("/") + 1); 
        
        // is same with remote? this array contains files this info.
        let tempArray = []; 
        let print = document.getElementById("out");

        for (let index = 0; index < a.length; index++) {
          let reader = new FileReader();

          if (
            a[index].type === "text/html" ||
            a[index].type === "text/plain" ||
            a[index].type === "image/png" ||
            a[index].type === "image/jpg" ||
            a[index].type === "image/jpeg"
          ) {
            if (a[index].size === b.size) {
              tempArray.push(a[index].name);
            }
          }
        }

        print.innerText = "Remote file " + url + "\n";
        print.innerText =
          print.innerText + "Choose files:" + a.length + " Files \n";

        for (let t = 0; t < a.length; t++) {
          print.innerText = print.innerText + a[t].name + ", ";
        }

        print.innerText = print.innerText + "\nResult:";

        if (tempArray.length === 0) {
          print.innerText = print.innerText + "All are diffrent.";
        } else {
          for (let i = 0; i < tempArray.length; i++) {
            print.innerText = print.innerText + tempArray[i] + ", ";
          }
          print.innerText = print.innerText + "is the same as " + filename;
        }

        //reader.readAsDataURL(b);

        //Implement this
      }
      const L = console.log;
      docName.innerText = document.title;
      sample.innerText = fileSelect + "\n" + checkFiles;
    </script>
  </body>
</html>
